<%# app/views/lists/_list.html.erb %>
<div id="<%= dom_id list %>" class="list bg-light border rounded p-3 d-flex flex-column" data-task-list-slug-value="<%= list.slug%>">
  <div class="d-flex justify-content-between align-items-start mb-2 position-relative">
    <strong><%= list.name %></strong>
    <div class="dropdown">
      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="listMenu<%= list.id %>" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="bi bi-three-dots-vertical"></i>
      </button>
      <ul class="dropdown-menu dropdown-menu-end"
          aria-labelledby="listMenu<%= list.id %>"
          style="z-index: 2000">
        <li>
          <button class="dropdown-item" data-action="click->list-form#edit" data-list='{"id":"<%= list.id%>", "name": "<%= j list.name%>", "url": "<%= board_list_path(@board,list) %>"}'>Edit</button>
        </li>
        <li><%= button_to "Delete", board_list_path(@board, list), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this list?" }, class: "dropdown-item text-danger" %></li>
      </ul>
    </div>
  </div>
  <%# tasks %>
  <ul data-controller="sortable"
      data-sortable-group-value="tasks"
      data-sortable-list-id="<%= list.id %>"
      class="flex-grow-1 overflow-auto">
    <% list.tasks.rank(:row_order).each do |task| %>
      <% css_classes= "p-2 rounded shadow-sm"%>
      <% if task.due_date.present? %>
        <% if task.due_date < Date.today %>
          <% css_classes += " bg-danger text-white" %>
        <% elsif task.due_date == Date.today %>
          <% css_classes += " bg-warning text-dark" %>
        <% end %>
      <% end %>
      <li data-sortable-update-url="<%= sort_task_path(task) %>" class="<%= css_classes%>  border rounded px-2 py-1 mb-2 shadow-sm" id="<%= dom_id(task)%>">
        <%= render partial: "tasks/task", locals: { task: task } %>
      </li>
    <% end %>
  </ul>
  <button class="btn btn-sm btn-outline-primary mt-2" data-action="click->tasks#modal" data-task-list-slug-value="<%= list.slug %>"> New task</button>
</div>
