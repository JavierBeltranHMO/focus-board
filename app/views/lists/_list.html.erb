<div id="<%= dom_id list %>" class="list bg-light border rounded p-3 d-flex flex-column" data-controller="tasks" data-task-list-id-value="<%= list.id%>">
  <div class="d-flex justify-content-between align-items-start mb-2 position-relative">
    <strong><%= list.name %></strong>
    <div class="dropdown">
      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="listMenu<%= list.id %>" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="bi bi-three-dots-vertical"></i>
      </button>
      <ul class="dropdown-menu dropdown-menu-end"
          aria-labelledby="listMenu<%= list.id %>"
          style="z-index: 2000">
        <li><%= link_to "Edit", edit_board_list_path(@board, list), class: "dropdown-item" %></li>
        <li><%= button_to "Delete", board_list_path(@board, list), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this list?" }, class: "dropdown-item text-danger" %></li>
      </ul>
    </div>
  </div>
  <ul data-controller="sortable"
      data-sortable-group-value="tasks"
      data-sortable-list-id="<%= list.id %>"
      class="flex-grow-1 overflow-auto">
    <% list.tasks.rank(:row_order).each do |task| %>
      <li data-sortable-update-url="<%= sort_task_path(task) %>" class="bg-white border rounded px-2 py-1 mb-2 shadow-sm" id="<%= dom_id(task)%>">
        <%= render task %>
      </li>
    <% end %>
  </ul>
  <button class="btn btn-sm btn-outline-primary mt-2" data-action="click->tasks#modal"> New task</button>
  <%# tasks modal %>
  <div id="new-task-modal" class="modal fade" tabindex="-1" role="dialog"
     data-tasks-target="modal"
     data-board-id="<%= @board.id %>">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <%= form_with url: board_list_tasks_path(@board, 0), method: :post, data: { turbo_frame: "_top" }, local: true do |f| %>
          <div class="modal-header">
            <h5 class="modal-title">New Task</h5>
            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <%= f.hidden_field :list_id, data: { tasks_target: "listIdField" } %>
            <div class="mb-3">
              <%= f.label :name %>
              <%= f.text_field :name, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :description %>
              <%= f.text_area :description, class: "form-control" %>
            </div>
          </div>
          <div class="modal-footer">
            <%= f.submit "Create Task", class: "btn btn-primary" %>
            <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
